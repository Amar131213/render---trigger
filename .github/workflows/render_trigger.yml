name: Trigger Render Daily

on:
  schedule:
    - cron: '30 11 * * 1-5'  # ‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞, ‡§∂‡§æ‡§Æ 5 ‡§¨‡§ú‡•á IST
  workflow_dispatch:

jobs:
  trigger_render:
    runs-on: ubuntu-latest
    steps:
      - name: Call Render /run and Wait for Expected Response
        run: |
          echo "‚û°Ô∏è Calling https://screener-scraper.onrender.com/run"
          
          # ‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•ã, 90 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§§‡§ï wait ‡§ï‡§∞‡§®‡•á ‡§¶‡•ã
          RESPONSE=$(curl -s --max-time 90 "https://screener-scraper.onrender.com/run")

          echo "üì® Response received: $RESPONSE"

          # Expected JSON match
          EXPECTED='{"status":"üü¢ Scraper started in background."}'

          if [[ "$RESPONSE" == "$EXPECTED" ]]; then
            echo "‚úÖ Exact expected response matched."
          else
            echo "‚ùå Response did NOT match expected. Failing workflow."
            exit 1
          fi
