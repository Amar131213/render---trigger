name: Trigger Render Scraper

on:
  schedule:
    - cron: '30 11 * * 1-5'
  workflow_dispatch:

jobs:
  trigger_render:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger Render Once and Wait 2 Minutes
        run: |
          echo "ğŸš€ Triggering Render /run endpoint and waiting full 2 minutes..."

          RESPONSE=$(curl -v --connect-timeout 30 --max-time 120 \
            -s -w "\n\nHTTP_CODE:%{http_code}\nâ±ï¸ Time Taken: %{time_total}s\n" \
            https://screener-scraper.onrender.com/run 2>&1)

          echo "ğŸ§¾ FULL RESPONSE:"
          echo "$RESPONSE"

          echo "$RESPONSE" | grep -q "ğŸŸ¢ Scraper started in background." && {
            echo "âœ… Success: Scraper started"
            exit 0
          }

          echo "âš ï¸ Warning: Expected message not found in response."
          exit 1
