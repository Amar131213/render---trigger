name: Trigger Render Scraper

on:
  schedule:
    - cron: '30 11 * * 1-5'
  workflow_dispatch:

jobs:
  trigger_render:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger Render Once and Wait 2 Minutes
        run: |
          echo "🚀 Triggering Render /run endpoint and waiting full 2 minutes..."

          RESPONSE=$(curl -v --connect-timeout 30 --max-time 120 \
            -s -w "\n\nHTTP_CODE:%{http_code}\n⏱️ Time Taken: %{time_total}s\n" \
            https://screener-scraper.onrender.com/run 2>&1)

          echo "🧾 FULL RESPONSE:"
          echo "$RESPONSE"

          echo "$RESPONSE" | grep -q "🟢 Scraper started in background." && {
            echo "✅ Success: Scraper started"
            exit 0
          }

          echo "⚠️ Warning: Expected message not found in response."
          exit 1
